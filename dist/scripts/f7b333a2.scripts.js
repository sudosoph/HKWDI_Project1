angular.module("LocalStorageModule").value("prefix","tickeyDB"),angular.module("tickeyApp",["LocalStorageModule","firebase"]).config(["$routeProvider",function(a){a.when("/gameboard",{templateUrl:"views/gameboard.html",controller:"GameBoardCtrl"}).when("/howto",{templateUrl:"views/howto.html",controller:"HowToCtrl"}).when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/matchplayer",{templateUrl:"views/matchplayer.html",controller:"MatchPlayerCtrl"}).when("/multiplayer/:id/:symbol",{templateUrl:"views/multiplayer.html",controller:"MultiplayerCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("tickeyApp").controller("MainCtrl",["$scope","$rootScope",function(a,b){b.hideHome=!0,b.hideGameBoard=!1,b.hideHowTo=!1,a.name="Main"}]),angular.module("tickeyApp").controller("GameBoardCtrl",["$scope","$rootScope","$timeout","$routeParams","localStorageService","angularFire",function(a,b,c,d,e,f){a.gameBoardId=d.id,a.mySymbol=d.mySymbol,a.gameBoard=[];var g=new Firebase("https://sophia-ttt.firebaseio.com/room/"+d.id);a.promise=f(g,a,"gameBoard");var h=new Firebase("https://sophia-ttt.firebaseio.com");f(h,a,"leaderData"),a.promise.then(function(){0==a.gameBoard.length&&"x"==d.mySymbol?(console.log("I am First Move: Symbol: "+d.mySymbol),a.makeMyMove()):(console.log("I am Second Move: Symbol: "+d.mySymbol),a.waitForOpponentToMove())}),a.waitForOpponentToMove=function(){g.once("child_added",function(){a.isLosing()||a.isDraw()||a.makeMyMove()})},a.getName=function(){a.userName=prompt("Enter your name")},a.addWinToLeaderboard=function(){a.userName&&(a.leaderData.leaderBoard.hasOwnProperty(a.userName)?a.leaderData.leaderBoard[a.userName]++:a.leaderData.leaderBoard[a.userName]=1)},b.hideGameBoard=!0,b.hideHowTo=!1,b.hideHome=!1,b.gameEnded=!1,a.cells=["","","","","","","","",""],a.name="Gameboard",a.addWin=e.get("addWin"),void 0==a.addWin&&(a.addWin=0),a.currentSymbol="x",a.isDiagonalSameSymbols=function(b){return a.firstDiagonalCheck=a.cells[0]==b&&a.cells[4]==b&&a.cells[8]==b,console.log("checks first diagonal"),a.secondDiagonalCheck=a.cells[2]==b&&a.cells[4]==b&&a.cells[6]==b,console.log("checks second diagonal"),a.firstDiagonalCheck||a.secondDiagonalCheck},a.notOccupied=function(b){return a.result=""==a.cells[b-1],a.result},a.makeNextMove=function(b,c){a.cells[b-1]=c},a.isWinning=function(b){for(var c=0;9>=c;c+=3)if(console.log("check horizontal"),a.isSameSymbolsIn(a.cells[c],a.cells[c+1],a.cells[c+2],b))return!0;for(var c=0;3>=c;c++)if(console.log("check vertical"),a.isSameSymbolsIn(a.cells[c],a.cells[c+3],a.cells[c+6],b))return!0;return a.isDiagonalSameSymbols(b)},a.isSameSymbolsIn=function(b,c,d,e){return a.first_comparison=b==e,a.second_comparison=c==e,a.third_comparison=d==e,a.result=a.first_comparison&&a.second_comparison&&a.third_comparison,console.log(a.first_comparison),console.log(a.second_comparison),console.log(a.third_comparison),a.result},a.swapSymbol=function(){a.currentSymbol="x"==a.currentSymbol?"o":"x"},a.addScore=function(){a.addWin=parseInt(a.addWin)+1,e.add("addWin",a.addWin)},a.handleClick=function(c){a.notOccupied(c)&&a.makeNextMove(c,a.currentSymbol),a.isWinning(a.currentSymbol)?(alert(a.currentSymbol+" wins!"),a.addScore(),b.gameEnded=!0):(a.swapSymbol(),console.log("swaps player"),setTimeout(function(){a.$apply(function(){a.selectRandomSquare(a.currentSymbol),console.log("Selects random sq"),a.isLosing(),a.swapSymbol(),console.log("second swap"),console.log(a.cells)})},1e3))},a.isLosing=function(){a.isWinning(a.currentSymbol)&&(alert(a.currentSymbol+" wins!"),a.addScore(),b.gameEnded=!0)},a.clearBoard=function(){for(var b=0;9>=b;b++)a.cells[b]="",console.log("clearBoard executed")},a.restartGame=function(){console.log("restartGame"),console.log("clearBoard called"),a.clearBoard(),a.currentSymbol="x",b.gameEnded=!1},a.selectRandomSquare=function(b){a.randomnumber;do a.randomnumber=Math.floor(9*Math.random())+1;while(!a.notOccupied(a.randomnumber));a.makeNextMove(a.randomnumber,b)},a.minutes="00",a.seconds="00",a.currentNumberOfSeconds=0,a.intervalCallback,a.increment=function(){a.currentNumberOfSeconds++,a.minutes=a.formatZeroPadding(Math.floor(a.currentNumberOfSeconds/60)),a.seconds=a.formatZeroPadding(a.currentNumberOfSeconds%60),a.intervalCallback=c(a.increment,1e3)},a.startTimer=function(){a.intervalCallback=c(a.increment,1e3)},a.stopTimer=function(){c.cancel(a.intervalCallback)},a.resetTimer=function(){a.minutes="00",a.seconds="00"},a.formatZeroPadding=function(a){return 10>a?"0"+a:a}}]),angular.module("tickeyApp").controller("MatchPlayerCtrl",["$scope","angularFire","$routeParams","$location",function(a,b,c,d){function e(){return Math.floor(16777215*Math.random()).toString(16)}a.waitingRoom=[];var f=new Firebase("http://sophia-ttt.firebaseio.com/waitingroom/"+c.id);a.promise=b(f,a,"waitingRoom",[]),a.promise.then(function(){1==a.waitingRoom.xJoined?a.joinWaitingRoom():a.createWaitingRoom()}),a.createWaitingRoom=function(){a.waitingRoom={xJoined:!0,gameBoardNumber:e()},a.noticeMessage="You are x, waiting for opponent.",f.on("child_removed",function(){d.path("multiplayer/"+a.waitingRoom.gameBoardNumber+"/x")})},a.joinWaitingRoom=function(){var b=a.waitingRoom.gameBoardNumber;console.log("before waiting room"),a.waitingRoom={},console.log("after waiting room"),d.path("multiplayer/"+b+"/o")}}]),angular.module("tickeyApp").controller("HowToCtrl",["$scope","$rootScope","localStorageService",function(a,b){b.hideHowTo=!0,b.hideGameBoard=!1,b.hideHome=!1,a.name="How To"}]),angular.module("tickeyApp").directive("tickleMe",function(){return{restrict:"A",link:function(a,b){b.bind("click",function(){alert("Don't tickle me ~ ")})}}}),angular.module("tickeyApp").controller("MultiplayerCtrl",["$scope","$rootScope","$timeout","$routeParams","angularFire",function(a,b,c,d,e){function f(a,b){return!(b>a||a>b)}a.gameBoardId=d.id,a.mySymbol=d.symbol,a.myTurn=!1,a.turnNum=0,b.gameEnded=!1,a.cells=["","","","","","","","",""];var g=new Firebase("https://sophia-ttt.firebaseio.com/room/"+d.id);a.promise=e(g,a,"cells",[]),a.promise.then(function(){console.log("In Game Board"),console.log(a.gameBoardId),console.log(a.mySymbol),a.cells=["","","","","","","","",""],0==a.cells.length&&"x"==d.symbol?(console.log("I am First Move: Symbol: "+d.symbol),a.myTurn=!0):(console.log("I am Second Move: Symbol: "+d.symbol),a.myTurn=!1)}),g.on("value",function(b){console.log("snapshot received"),a.gameEnded||a.myTurn?console.log("My turn but receiving"):null!=b.val()?f(b.val(),a.cells)?console.log("same gameboard"):(console.log("different gameboard- data from remote"),a.isLosing(a.mySymbol,b.val())?(console.log("opponent won. you lost."),c(function(){window.alert("You lost!")},50),a.gameEnded=!0):a.isDraw()?(console.log("It's a tie!"),a.mySymbol="",a.gameEnded=!0):(console.log("My turn"),a.myTurn=!0,a.turnNum++),console.log("After opponent clicked: turn # "+a.turnNum+"$scope.cells: "+b.val().join(""))):console.log("Snapshot empty")}),a.handleClick=function(b){a.gameEnded||a.myTurn&&a.notOccupied(b)&&(console.log("I clicked on index: "+b),a.gameBoard[b]=a.mySymbol,a.isWinning(a.mySymbol,a.gameBoard)?(c(function(){window.alert("You won!")},50),a.gameEnded=!0):a.isDraw()?(a.mySymbol="",a.gameEnded=!0):(a.myTurn=!1,a.turnNum++),console.log("After my click: turn # "+a.turnNum+"$scope.gameBoard: "+a.gameBoard.join("")))};var h=["xxx......","...xxx...","......xxx","x..x..x..",".x..x..x.","..x..x..x","x...x...x","..x.x.x.x.."],i=h.map(function(a){return a.replace(/x/g,"o")});a.isWinning=function(b,c){console.log("isWinning"),a.gameBoardStr=c.join("");var d=/\s/g,e=a.gameBoardStr.replace(d,".");if(console.log("Gameboard String: "+e),"x"==playerSymbol)var f=h;else var f=i;for(var g=0;g<f.length;g++){var j=new RegExp(patterns[g],"i");if(e.match(j))return console.log("Pattern Matching success. We won"),!0}return!1},a.isLosing=function(b,c){var d="x"==b?"o":"x";return a.testForWin(d,c)},a.isDraw=function(){return 9===a.turnNum},b.hideGameBoard=!0,b.hideHowTo=!1,b.hideHome=!1,a.currentSymbol="x",a.notOccupied=function(b){return a.result=""==a.cells[b-1],a.result},a.clearBoard=function(){for(var b=0;9>=b;b++)a.cells[b]=""},a.restartGame=function(){a.clearBoard(),a.currentSymbol="x",b.gameEnded=!1}}]);